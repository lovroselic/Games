
console.clear();VERSION="1.01";console.log("ConvertiX V"+VERSION+" by Lovro Selic, (c) C00lSch00l 2015");MIN_ROUNDS=10;MAX_ROUNDS=100;DEFAULT_ROUNDS=10;BOARD_MAX_HEIGHT=400;var buttonSubmit="<input type=button' id='submit' value='' title='Click here to submit answer or use Enter' />";Array.prototype.sum=function(){var a=this.length;var b=0;for(var c=0;c<a;c++){b+=parseFloat(this[c])}return b||-1};Array.prototype.average=function(){var b=this.sum();var a=this.length;return b/a||-1};var convertix={round:0,right:0,mercyless:true,start:function(){this.round=0;this.right=0}};var timer={A:0,B:0,collection:[]};var unit=function(c,b,a){this.prefix=c;this.symbol=b;this.factor=a};var units=[new unit("","",0),new unit("deca","da",1),new unit("hecto","h",2),new unit("kilo","k",3),new unit("mega","M",6),new unit("giga","G",9),new unit("deci","d",-1),new unit("centi","c",-2),new unit("mili","m",-3),new unit("micro","Î¼",-6),new unit("nano","n",-9)];var measure=function(b,d,c,a){this.name=b;this.unit=d;this.uname=c;this.typical=a};var measures=[new measure("mass","g","gram",[0,1,3,-3,-6].sort(sortNumber)),new measure("volume","l","liter",[0,2,-1,-2,-3,-6].sort(sortNumber)),new measure("length","m","meter",[0,3,-2,-3,-6,-9].sort(sortNumber))];function setUp(){var b=measures.length;for(var a=0;a<b;a++){$("#select").append("<option value='"+a+"'>"+measures[a].name.toUpperCase()+"</option>")}addUnits()}function addUnits(){var a=parseInt($("#select").val(),10);var d=measures[a].typical.length;$("#unit").html("");for(var b=0;b<d;b++){var c=searchUnits(measures[a].typical[b]);$("#unit").append("<option value='"+c+measures[a].unit+"'>"+c+measures[a].unit+"</option>")}}function SearchObject(a,c,e){var d=units.length;for(var b=0;b<d;b++){if(a==units[b][c]){return units[b][e]}}return false}function searchUnits(a){return SearchObject(a,"factor","symbol")}function searchFactor(a){return SearchObject(a,"symbol","factor")}function decimalPlaces(b){var a=(""+b).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!a){return 0}return Math.max(0,(a[1]?a[1].length:0)-(a[2]?+a[2]:0))}function disableSetup(a){var c=$("#panel1").children();var b=c.length;for(var d=0;d<b;d++){$(c[d]).prop("disabled",a)}}function game(){$("#board").addClass("win");$("#board").removeClass("vertical");$("#board").css("height","auto");$("#board").html("");disableSetup(true);convertix.start();if($("#mercyless").prop("checked")===true){convertix.mercyless=true}else{convertix.mercyless=false}newLine()}function newLine(){convertix.round++;var c=rnd(1,measures.length)-1;var g=measures[c].unit;var b=measures[c].typical.length-1;var e=rnd(0,b);var i=measures[c].typical[e];var a=[];if(e<b){a.push(e+1)}if(convertix.mercyless&&e+1<b){a.push(e+2)}if(e>0){a.push(e-1)}if(convertix.mercyless&&e>1){a.push(e-2)}var h=measures[c].typical[a[rnd(0,a.length-1)]];var l=createNumber();var j="<p id='P"+convertix.round+"'><span class='shouldbe'>"+convertix.round+". </span>"+l+" "+searchUnits(i)+g+" = ";j+="<input type='text' maxlength='10' size='10' id='answer'/> ";j+=searchUnits(h)+g+" "+buttonSubmit+"</p>";print(j);$("#answer").focus();var d=i-h;var n=l*Math.pow(10,d);var f=decimalPlaces(l);var k=f-d;if(d>=f){n=parseInt(Math.round(n),10)}else{n=n.toFixed(k)}convertix.result=n;timer.A=window.performance.now();var m=$("#board").css("height");m=cssToInt(m);if(m>BOARD_MAX_HEIGHT){$("#board").addClass("vertical");$("#board").height(BOARD_MAX_HEIGHT)}$("#P"+convertix.round)[0].scrollIntoView()}function showHelp(){$("#board").addClass("win");$("#board").html("");var l=parseFloat($("#help_val").val());if(isNaN(l)){$("#board").removeClass("win");alert("Please enter a number.");return}var g=decimalPlaces(l);var a=$("#unit").val();var b=l+" "+a+" = ";var j=parseInt($("#select").val(),10);var h=measures[j].typical.length;var m=a.indexOf(measures[j].unit);var c=a.substring(0,m);var i=searchFactor(c);for(var e=0;e<h;e++){var d=i-measures[j].typical[e];var f=l*Math.pow(10,d);var k=g-d;if(d>=g){f=parseInt(Math.round(f),10)}else{f=f.toFixed(k)}f+=" "+searchUnits(measures[j].typical[e]);f+=measures[j].unit;print(b+f)}}function createNumber(){var b,c,a,d;do{b=Math.random();if(convertix.mercyless){c=rnd(0,4)}else{c=rnd(1,2)}if(convertix.mercyless){a=rnd(0,3)}else{a=rnd(0,1)}b=b*Math.pow(10,c);b=b.toFixed(a);if(convertix.mercyless){d=0.001}else{d=0.1}}while(b<0.1);return b}function checkResult(){timer.B=window.performance.now();var b=getTime();timer.collection.push(b);var a=$("#answer").val().toString(10);if(a===convertix.result.toString(10)){$("#answer").replaceWith("<span class='right'>"+convertix.result.toString(10)+"</span>");$("#submit").remove();convertix.right++}else{$("#answer").replaceWith("<span class='wrong'>"+a+"</span> ---> <span class='shouldbe'>"+convertix.result.toString(10)+"</span>");$("#submit").remove()}if(convertix.round>=convertix.how_many){endGame()}else{newLine()}}function endGame(){disableSetup(false);var a=convertix.right/convertix.round*100;print("<br>");print("Your accuracy: "+a+"%. "+getGrade(a));print("<p id='last'>Your average response time: "+timer.collection.average().toFixed(1)+" seconds.</p>");$("#last")[0].scrollIntoView()}function getTime(){var a=(timer.B-timer.A)/1000;a=a.toFixed(2);return a}$(document).ready(function(){$("#version").html("ConvertiX version "+VERSION);setUp();$("#select").click(function(){addUnits()});$("#help").click(function(){showHelp()});$("#how_many").focusout(function(){var a=$(this).val();$(this).val(validateInput(a,MIN_ROUNDS,MAX_ROUNDS,DEFAULT_ROUNDS))});$("#game").click(function(){convertix.how_many=$("#how_many").val();game()});$("#board").on("keypress","#answer",function(b){if(b.which==13){b.preventDefault();checkResult()}});$("#board").on("click","#submit",function(){checkResult()})});function cssToInt(b){var a=b.indexOf("px");var c=b.substring(0,a);return parseInt(c,10)}function validateInput(d,b,a,c){if(isNaN(d)){return c}if(d<b){return b}if(d>a){return a}return d}function print(b){a(b,"p");function a(d,c){$("#board").append("<"+c+">"+d+"</"+c+">")}}function rnd(b,a){return Math.floor(Math.random()*(++a-b)+b)}function getGrade(b){switch(true){case (b===100):return"Amazing! Perfect score.";case (b>95):return"Excellent";case (b>90):return"Very well done.";case (b>80):return"Nice.";case (b>=70):return"Hmmm. Play again and try to do better.";case (b<70):return"This was not good. You should practice more."}}function sortNumber(d,c){return d-c};