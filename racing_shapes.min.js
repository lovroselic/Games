
console.log("Racing Shapes - coded by Lovro Selic , C00lSch00l 2014, 2015; version 1.07");var hiscore=[100,75,50,25,15];var hiscore_name=["C00lSch00l","C00lSch00l","C00lSch00l","C00lSch00l","C00lSch00l"];var gameID="RS";var Racer=function(d,c,b,e,a){this.name=d;this.shape=c;this.color=b;this.speed=e;this.position=a};var timeA,timeB;var racersObj=[];var howManyRacers=8;var shapes=["circle","square","rectangle","triangle"];var colorCollection=["red","green","blue","yellow","black","white","brown","orange","grey","purple","pink","cyan"];var inpField="<form action =''><input type='text' id='odgovor' size='16' name='odgovor' /></form>";var button="<input type=button' id='submit' value='' title='Click here to submit answer or use Enter' />";var timerFlag=false;$(document).ready(function(){var a,d,c,b;$("form").bind("keypress",function(f){if(f.keyCode==13){return false}});loadHS();hiScore();$("#help h3").click(function(){$("#colours").toggle(500,"swing")});$("#help2 h3").click(function(){$("#shape").toggle(500,"swing")});$("#start").click(function(){gameStart()});$("#race").click(function(){countDown()});$("#panel").on("keypress","#odgovor",function(e){if(e.which==13){e.preventDefault();checkResult()}});$("#panel").on("click","#submit",function(){checkResult()});$("#laps").focusout(function(){var e=$(this).val();$(this).val(validateInput(e,5,25,10))});$("#next").click(function(){nextRace()})});function hiScore(){var b="";for(var a=1;a<=5;a++){b+=a+". "+hiscore_name[a-1]+" "+pad(hiscore[a-1],5)+"<br/>"}$("#hiscore").html(b);saveHS();return}function saveHS(){localStorage.setItem(gameID,"OK");for(var a=0;a<5;a++){localStorage.setItem(gameID+"_HName"+a,hiscore_name[a]);localStorage.setItem(gameID+"_HScore"+a,hiscore[a])}}function loadHS(){if(localStorage[gameID]==="OK"){for(var a=0;a<5;a++){hiscore_name[a]=localStorage.getItem(gameID+"_HName"+a);hiscore[a]=localStorage.getItem(gameID+"_HScore"+a)}}}function checkScore(c){var e=4;while(c>hiscore[e]&&e>=0){e--}e++;if(e===5){return}else{var a=prompt("You reached top 5 score. Enter your name (max 10 characters): ");if(a.length>10){a=a.substring(0,10)}else{if(a.length<10){var b=10-a.length;var d=stringFill("&nbsp",b);a+=d}}hiscore.splice(e,0,c);hiscore_name.splice(e,0,a);hiscore.splice(5,1);hiscore_name.splice(5,1)}$("#setup")[0].scrollIntoView();return}function stringFill(a,c){var b="";for(;;){if(c&1){b+=a}c>>=1;if(c){a+=a}else{break}}return b}function pad(a){var b="\u0020\u0020\u0020\u0020\u0020"+a;return b.substring(b.length-5)}function endGame(){$("#RTG").hide();$("#next").prop("disabled",true);$("#start").prop("disabled",false);$("#message").html("<span class='shoudlbe'>Congratulations. You managed to get "+score+" points.</span>");checkScore(score);hiScore();$("input[name='quest']").prop("disabled",false);$("#laps").prop("disabled",false);return}function nextRace(){$("#next").prop("disabled",true);$("#message").html("");$("#count").hide();hideRacers();getReady();Solution=askQuestion();$("#race").prop("disabled",false);return}function hideRacers(){for(var a=1;a<=howManyRacers;a++){var b="#R"+a;$(b).remove()}return}function trimInput(a){a=a.trim().toLowerCase();var c=a.indexOf(" ");if(c!=-1){var d=a.substring(0,c);var b=a.substring(c);a=d.trim()+" "+b.trim()}return a}function checkResult(){var c=new Date();timeB=c.getTime();if(timerFlag){var b=Math.floor((timeB-timeA)/1000)}else{var b=1}var a=$("#odgovor").val();a=trimInput(a);if(a===Solution){$("#answer form").hide();$("#submit").hide();$("#answer p").append("<span class='right'>"+Solution+".</span>");$("#message").html("<span class='right'>Excellent!</span>");score+=10+Math.floor(score/4)+Math.floor(score/b);$("#score").text(score)}else{$("#answer form").hide();$("#submit").hide();$("#answer p").append("<span class='wrong'>"+a+"</span>");$("#answer p").append("&nbsp <span class='shouldbe'>"+Solution+".</span>");$("#message").html("<span style='color:red'>Wrong!</span>");score-=5;if(score<0){score=0}$("#score").text(score)}NLaps--;$("#togo").text(NLaps);if(!NLaps){endGame();return}$("#next").prop("disabled",false);$("#panel")[0].scrollIntoView();return}function gameStart(){$("#panel")[0].scrollIntoView();$("#RTG").show();$("#message").html("");$("input[name='quest']").prop("disabled",true);$("#start").prop("disabled",true);$("#laps").prop("disabled",true);$("#race").prop("disabled",false);gameType=determineGameType();score=0;$("#score").text(score);NLaps=parseInt($("#laps").val(),10);$("#togo").text(NLaps);hideRacers();getReady();Solution=askQuestion();return}function askQuestion(){var a=gameType.length;if(a>1){solution=gameType[rnd(0,a-1)]()}else{solution=gameType[0]()}return solution}function getReady(){prepareRacers(howManyRacers);setSpeed();determinePosition();return}function determineGameType(){var a=$("input[name='quest']");var b=[findShape,findPosition];if(a[0].checked===true){b.splice(0,1)}else{if(a[1].checked===true){b.splice(1,1)}}return b}function createPossible(e,a){var b=[];var f;for(var d=0;d<e.length;d++){for(var c=0;c<a.length;c++){f=e[d]+"_"+a[c];b.push(f)}}return b}function countDown(){timerFlag=false;$("#board")[0].scrollIntoView();$("#race").prop("disabled",true);var a=5;$("#count").show();$("#count span").text(a);var b=setInterval(function(){$("#count span").text(a--);if(a==-1){RACE();$("#odgovor").prop("disabled",false);$("#submit").prop("disabled",false);var c=setTimeout(function(){$("#odgovor").focus();var e=new Date();timeA=e.getTime();timerFlag=true},6100);clearInterval(b)}},1000);return}function RACE(){for(var a=1;a<=howManyRacers;a++){var b="#R"+a;$(b).animate({left:"+=912"},racersObj[a-1].speed)}return}function rnd(b,a){return Math.floor(Math.random()*(++a-b)+b)}function setShape(e,b,a){var c=a+" "+b;var d="<div id ='"+e+"' class='"+c+"'></div>";$("#board").append(d);return}function prepareRacers(f){var h=createPossible(colorCollection,shapes);for(var d=1;d<=f;d++){racersObj[d-1]=new Racer("R"+d);var c=h.length;var i=rnd(0,c-1);var j=h.splice(i,1);var a=j[0].indexOf("_");var e=j[0].substring(0,a);racersObj[d-1].color=e;var g=j[0].substring(a+1);racersObj[d-1].shape=g;if(g==="triangle"){e=j[0]}var b="R"+d;setShape(b,g,e)}return}function setSpeed(){var a=[];var c=[];for(var f=10;f<31;f++){c.push(f)}for(var d=0;d<howManyRacers;d++){var e=c.length;var b=c.splice(rnd(0,e-1),1);a.push(b[0]*200);racersObj[d].speed=a[d]}return a}function determinePosition(){var a=[];for(var b=0;b<howManyRacers;b++){a.push(racersObj[b].speed)}a.sort(sortNumber);for(var d=0;d<howManyRacers;d++){var c=a.indexOf(racersObj[d].speed);racersObj[d].position=++c}return}function sortNumber(d,c){return d-c}function numToOrd(a){switch(a){case 1:return"first";case 2:return"second";case 3:return"third";case 4:return"fourth";case 5:return"fifth";case 6:return"sixth";case 7:return"seventh";case 8:return"eighth";default:return -1}}function ordToNum(a){switch(a){case"first":return 1;case"second":return 2;case"third":return 3;case"fourth":return 4;case"fifth":return 5;case"sixth":return 6;case"seventh":return 7;case"eighth":return 8;default:return -1}}function findPosition(){var b="<p>Tell me the finishing position of the ";var c="<p>The ";var a=rnd(0,7);b+=racersObj[a].color;c+=racersObj[a].color;b+=" ";c+=" ";b+=racersObj[a].shape;c+=racersObj[a].shape;c+=" came </p>";b+=".</p>";$("#question").html(b);var d=numToOrd(racersObj[a].position);c+=inpField+button;$("#answer").html(c);$("#odgovor").prop("disabled",true);$("#submit").prop("disabled",true);return d}function findShape(){var b="<p>Tell me which shape finishes ";var c="<p>The ";var a=rnd(0,7);b+=numToOrd(racersObj[a].position);c+=numToOrd(racersObj[a].position);c+=" shape through finish line was the </p>";b+=".</p>";$("#question").html(b);var d=racersObj[a].color;d+=" ";d+=racersObj[a].shape;c+=inpField+button;$("#answer").html(c);$("#odgovor").prop("disabled",true);$("#submit").prop("disabled",true);return d}function validateInput(d,b,a,c){if(isNaN(d)){return c}if(d<b){return b}if(d>a){return a}return d};